<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Dashboard Template for Bootstrap</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="dashboard.css" rel="stylesheet">

    <META HTTP-EQUIV="VPI" CONTENT="
           <vpi xmlns='http://schemas.virtual-presence.org/vpi'>
             <location>
               <url>xmpp:myroom@location.virtual-presence.org</url>
             </location>
           </vpi>
          ">

</head>

<body>
<nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0">
    <span class="navbar-brand col-sm-3 col-md-2 mr-0" href="#">WeblinTheatre</span>
    <!--input class="form-control form-control-dark w-100" type="text" placeholder="Search" aria-label="Search">
    <ul class="navbar-nav px-3">
        <li class="nav-item text-nowrap">
            <a class="nav-link" href="#">Sign out</a>
        </li>
    </ul-->
</nav>

<div class="container-fluid">
    <div class="row">
        <nav class="col-md-2 d-none d-md-block bg-light sidebar">
            <div class="sidebar-sticky">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link active" href="#">
                            <span data-feather="home"></span>
                            Editor <span class="sr-only">(current)</span>
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <main role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
            <input id="room" value="https://weblin.sui.li"><br>
            <!--textarea id="script" style="width:100%;height:300px">
Che.setAvatar http://avatar.zweitgeist.com/gif/006/Che/config.xml
Galileo.setAvatar http://avatar.zweitgeist.com/gif/006/Galileo/config.xml
Marx.setAvatar http://avatar.zweitgeist.com/gif/006/Marx/config.xml
Liberty.setAvatar http://avatar.zweitgeist.com/gif/006/StatueOfLiberty/config.xml
Peach.setAvatar http://avatar.zweitgeist.com/gif/004/princess/config.xml
Rosa.setAvatar http://avatar.zweitgeist.com/gif/006/Luxemburg/config.xml

Scene 1
    System.pause 1000
    Liberty.join 600
    Peach.join 240
    Galileo.join 250
    Rosa.join 300
    Marx.join 350
    System.pause 4000

    Liberty.say Mit der Revolution ist es wie mit einem Fahrrad.
    System.pause 8000

    Marx.jumpTo 400
    System.pause 1000
    Marx.say Sie ist die Lokomotive der Geschichte?
    System.pause 2000

    Galileo.jumpTo 420
    System.pause 1000
    Galileo.say Sie dreht sich doch?
    System.pause 2000

    Rosa.jumpTo 440
    System.pause 1000
    Rosa.say Alles andere ist Quark?
    System.pause 2000
    Peach.say /do laugh

    System.pause 3000

    Che.join 100
    System.pause 1000
    Che.say /do deny
    System.pause 1500
    Che.say Rollt sie nicht vorw채rts, dann f채llt sie um!
    System.pause 3000

    Che.say /do idle3
    Peach.say /do cheer
    Rosa.say /do cheer
    Liberty.say /do clap
    Galileo.say /do cheer
    Marx.say /do cheer

    System.pause 10000


                        </textarea-->

            <button class="js-test">Execute</button>
            <i class="fas fa-play"></i>
            <i class="fas fa-pause"></i>
            <i class="fas fa-stop"></i>
            <p style="border:solid 1px;width:100%;"><textarea id="code">
Che.avatar http://avatar.zweitgeist.com/gif/006/Che/config.xml
Galileo.avatar http://avatar.zweitgeist.com/gif/006/Galileo/config.xml
Marx.avatar http://avatar.zweitgeist.com/gif/006/Marx/config.xml
Liberty.avatar http://avatar.zweitgeist.com/gif/006/StatueOfLiberty/config.xml
Peach.avatar http://avatar.zweitgeist.com/gif/004/princess/config.xml
Rosa.avatar http://avatar.zweitgeist.com/gif/006/Luxemburg/config.xml

Liberty.move 600
Peach.move 200
Galileo.move 250
Rosa.move 300
Marx.move 350
pause 4

Liberty.say Mit der Revolution ist es wie mit einem Fahrrad. 8

Marx.move 400 1
Marx.say Sie ist die Lokomotive der Geschichte? 2

Galileo.move 420 1
Galileo.say Sie dreht sich doch? 2

Rosa.move 440 1
Rosa.say Alles andere ist Quark? 2

Peach.say /do laugh 3

Che.move 100 1
Che.say /do deny 2
Che.say Rollt sie nicht vorw채rts, dann f채llt sie um! 3

Che.say /do idle3
Peach.say /do cheer
Rosa.say /do cheer
Liberty.say /do clap
Galileo.say /do cheer
Marx.say /do cheer

pause 10

            </textarea></p>

        </main>
    </div>
</div>

<div style="opacity:40%;z-index:999;position:fixed;left:0;bottom:0;width:100%;height:100px;background-image:url(/img/bg.png);pointer-events: none"></div>

<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script src="{$websocket}/socket.io.js"></script>

<script src="https://cdn.jsdelivr.net/npm/codemirror@5.52.2/lib/codemirror.min.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.52.2/lib/codemirror.css">
<script src="codemirrorMode.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js"></script>

<script>

      function  makeMarker() {
  var marker = document.createElement("div");
  marker.style.color = "#822";
  marker.innerHTML = '<i class="fas fa-exclamation-circle"></i>';
  return marker;
}
    class Site {

        constructor(ioserver) {
            this.ioserver = ioserver;
            this.initialized = false;
        }



        run() {
            let self = this;
            let tmp = this.ioserver.split('/');
            let path = '/' + tmp.pop();
            let host = tmp.join('/');
            this.io = io(host, {path: path});

            this.io.emitAsync = function (event, payload) {
                return new Promise(function (resolve, reject) {
                    return self.io.emit(event, payload, function (result) {
                        return resolve(result);
                    });
                })
            }

            $('.js-test').click(async function (e) {
                e.preventDefault();
                var info = myCodeMirror.lineInfo(2);
                  myCodeMirror.setGutterMarker(2, "wtf", info.gutterMarkers ? null : makeMarker());

                let data = {
                    room: $('#room').val(),
                    script: myCodeMirror.getValue(),
                }
                let result = await self.io.emitAsync('test', data);
            });
        }

    }

    $(function () {
        window.Site = new Site('{$websocket}');
        window.Site.run();

        CodeMirror.defineSimpleMode("simplemode", {
            // The start state contains the rules that are intially used
            start: [



                {
                    regex: /(.*?)(\.)(avatar|move|say|leave)(\s+)(.*)/,
                    token: ["def", null, "variable-2", null, "variable-3"]
                },

                {
                    regex: /(System\.pause)(\s+)(.*)/,
                    token: ["keyword", null, "variable-3"]
                },

            ],
            // The multi-line comment state.
            comment: [
                {regex: /.*?\XXX*\//, token: "comment", next: "start"},
                {regex: /.*XXX/, token: "comment"}
            ],
            // The meta property contains global information about the mode. It
            // can contain properties like lineComment, which are supported by
            // all modes, and also directives like dontIndentStates, which are
            // specific to simple modes.
            meta: {
                dontIndentStates: ["comment"],
                lineComment: "#"
            }
        });




        myCodeMirror = CodeMirror.fromTextArea(
            document.getElementById('code')
            , {
                mode: "simplemode",
                lineNumbers: true,
                styleActiveLine: true,
                gutters: ["wtf"],
            }
        );

    });

</script>

</body>
</html>
